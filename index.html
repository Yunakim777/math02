<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–∫—Ç–æ—Ä–∏–Ω–∞-–ë–∞—Ç–ª: –í–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “ö–∞—Ç–∞—Ä–ª–∞—Ä</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–∞ –∏ —Ñ–æ–Ω–∞ */
        body {
            font-family: 'Times New Roman', Times, serif; /* –®—Ä–∏—Ñ—Ç Times New Roman */
            background-color: #1f2937; /* –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            color: #f9fafb; /* –°–≤–µ—Ç–ª—ã–π —Ç–µ–∫—Å—Ç */
        }

        /* –ö–æ–º–∏–∫—Å–Ω—ã–π —Å—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∏ –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .comic-panel {
            border: 4px solid #1f2937; /* –¢–µ–º–Ω—ã–π –∫–æ–Ω—Ç—É—Ä */
            border-radius: 16px;
            box-shadow: 6px 6px 0px 0px #1f2937; /* –¢–æ–ª—Å—Ç–∞—è —Ç–µ–Ω—å */
            transition: transform 0.1s;
        }

        .comic-button {
            border: 3px solid #1f2937;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            box-shadow: 4px 4px 0px 0px #1f2937;
            transition: all 0.1s ease;
        }

        .comic-button:hover {
            box-shadow: 2px 2px 0px 0px #1f2937;
            transform: translate(2px, 2px);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞/–≤—ã–±–æ—Ä–∞ */
        .p1-color { background-color: #ef4444; color: white; } /* –ö—Ä–∞—Å–Ω—ã–π (Red-500) */
        .p2-color { background-color: #3b82f6; color: white; } /* –°–∏–Ω–∏–π (Blue-500) */
        .p1-text { color: #ef4444; }
        .p2-text { color: #3b82f6; }
        .p-bg-incorrect { background-color: #fee2e2; border-color: #ef4444; }
        .p-bg-correct { background-color: #d1fae5; border-color: #10b981; }

        /* –°—Ç–∏–ª—å –¥–ª—è –æ–ø—Ü–∏–π */
        .option-item {
            display: flex;
            align-items: center;
            border: 2px solid #1f2937;
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
            background-color: #fef3c7; /* –ñ–µ–ª—Ç—ã–π —Ñ–æ–Ω –¥–ª—è –æ–ø—Ü–∏–π */
            color: #1f2937;
            font-weight: 600;
            transition: background-color 0.1s;
        }

        /* –¢–∞–π–º–µ—Ä –±–∞—Ä */
        #timerBar {
            height: 100%;
            transition: width 1s linear;
        }

        /* –°–∫—Ä—ã—Ç–∏–µ MathJax, —Ç–∞–∫ –∫–∞–∫ —Ñ–æ—Ä–º—É–ª –Ω–µ—Ç */
        .MathJax { display: none !important; }

    </style>
</head>
<body>

    <div class="min-h-screen flex items-center justify-center p-4">
        <!-- Main Application Container -->
        <div id="appContainer" class="w-full h-full max-w-5xl">

            <!-- 1. Start Screen (–ë–∞—Å—Ç–∞—É —ç–∫—Ä–∞–Ω—ã) -->
            <div id="startScreen" class="text-center bg-yellow-400 p-8 comic-panel">
                <h1 class="text-4xl font-extrabold mb-6 text-gray-800">–í–∏–∫—Ç–æ—Ä–∏–Ω–∞-–ë–∞—Ç–ª: –í–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “ö–∞—Ç–∞—Ä–ª–∞—Ä</h1>
                <p class="text-gray-700 mb-8 font-semibold">
                    –ñ—ã–ª–¥–∞–º–¥—ã“õ –ø–µ–Ω –¥”ô–ª–¥—ñ–∫ –∂–∞—Ä—ã—Å—ã! –ö—ñ–º –±—ñ—Ä—ñ–Ω—à—ñ –±–æ–ª—ã–ø –¥“±—Ä—ã—Å –∂–∞—É–∞–ø –±–µ—Ä—Å–µ, —Å–æ–ª “±–ø–∞–π –∞–ª–∞–¥—ã. ”ò—Ä —Å“±—Ä–∞“õ“õ–∞ 10 —Å–µ–∫—É–Ω–¥ –±–µ—Ä—ñ–ª–µ–¥—ñ.
                </p>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-left">
                    <div class="p-4 bg-red-300 rounded-lg comic-panel">
                        <label for="p1Name" class="block font-bold text-lg mb-2 text-red-800">1-–û–π—ã–Ω—à—ã (–ë–∞—Å“õ–∞—Ä—É: A, S, D):</label>
                        <input type="text" id="p1Name" placeholder="1-–æ–π—ã–Ω—à—ã–Ω—ã“£ –∞—Ç—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" value="1-–û–π—ã–Ω—à—ã" class="w-full p-3 rounded border-2 border-red-800 focus:outline-none focus:ring-4 focus:ring-red-600">
                    </div>
                    <div class="p-4 bg-blue-300 rounded-lg comic-panel">
                        <label for="p2Name" class="block font-bold text-lg mb-2 text-blue-800">2-–û–π—ã–Ω—à—ã (–ë–∞—Å“õ–∞—Ä—É: J, K, L):</label>
                        <input type="text" id="p2Name" placeholder="2-–æ–π—ã–Ω—à—ã–Ω—ã“£ –∞—Ç—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" value="2-–û–π—ã–Ω—à—ã" class="w-full p-3 rounded border-2 border-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-600">
                    </div>
                </div>

                <button onclick="startGame()" class="comic-button bg-green-500 text-white mt-10 text-xl mx-auto block">
                    –ë–ê–¢–õ–î–´ –ë–ê–°–¢–ê–£!
                </button>
            </div>

            <!-- 2. Game Screen (–û–π—ã–Ω —ç–∫—Ä–∞–Ω—ã) -->
            <div id="gameScreen" class="hidden w-full bg-white rounded-xl shadow-2xl overflow-hidden">
                <!-- Question Display Area -->
                <div class="bg-gray-800 text-white p-4 text-center">
                    <h2 class="text-2xl font-bold mb-2">–°“±—Ä–∞“õ: <span id="currentQuestionNumber">1</span> / 10</h2>
                    <p id="questionText" class="text-xl font-semibold"></p>
                </div>
                
                <!-- Timer Bar -->
                <div class="h-4 bg-gray-300">
                    <div id="timerBar" class="bg-yellow-500"></div>
                </div>

                <!-- Player Panels -->
                <div class="flex">
                    <!-- Player 1 Panel (Left) -->
                    <div id="p1Panel" class="w-1/2 p-6 border-r-4 border-gray-800 bg-red-100 min-h-[400px]">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-red-500 pb-2">
                            <h3 class="text-2xl font-extrabold p1-text" id="p1Display">1-–û–π—ã–Ω—à—ã</h3>
                            <span class="text-3xl font-extrabold text-gray-800">“∞–ø–∞–π: <span id="p1Score">0</span></span>
                        </div>
                        <div id="p1Options" class="options-container">
                            <!-- Options for P1 -->
                        </div>
                        <div id="p1Status" class="mt-4 text-center text-lg font-bold"></div>
                    </div>

                    <!-- Player 2 Panel (Right) -->
                    <div id="p2Panel" class="w-1/2 p-6 bg-blue-100 min-h-[400px]">
                        <div class="flex justify-between items-center mb-4 border-b-2 border-blue-500 pb-2">
                            <h3 class="text-2xl font-extrabold p2-text" id="p2Display">2-–û–π—ã–Ω—à—ã</h3>
                            <span class="text-3xl font-extrabold text-gray-800">“∞–ø–∞–π: <span id="p2Score">0</span></span>
                        </div>
                        <div id="p2Options" class="options-container">
                            <!-- Options for P2 -->
                        </div>
                        <div id="p2Status" class="mt-4 text-center text-lg font-bold"></div>
                    </div>
                </div>
                
                <div class="p-4 bg-gray-800 text-center">
                    <button onclick="nextQuestion()" id="nextBtn" class="comic-button bg-yellow-500 text-gray-800 hidden">
                        –ö–µ–ª–µ—Å—ñ –°“±—Ä–∞“õ
                    </button>
                </div>
            </div>

            <!-- 3. Results Screen (–ù”ô—Ç–∏–∂–µ —ç–∫—Ä–∞–Ω—ã) -->
            <div id="resultsScreen" class="hidden text-center bg-white p-8 comic-panel border-4 border-yellow-500">
                <h2 class="text-4xl font-extrabold mb-6 text-gray-800">üéâ –ë–ê–¢–õ –ê–Ø“ö–¢–ê–õ–î–´! üéâ</h2>
                <div id="finalResults" class="mb-8 p-4 rounded-lg bg-gray-100 text-gray-800">
                    <!-- Final scores and winner displayed here -->
                </div>
                <button onclick="resetGame()" class="comic-button bg-indigo-600 text-white text-xl">
                    “ö–∞–π—Ç–∞ –û–π–Ω–∞—É
                </button>
            </div>

            <!-- Alert/Message Box (for key controls) -->
            <div id="messageBox" class="fixed top-0 left-1/2 -translate-x-1/2 mt-4 p-4 rounded-lg text-center text-white font-medium shadow-xl z-50 transition-all duration-300 opacity-0 hidden" style="min-width: 300px;">
                <p id="messageText"></p>
            </div>

        </div>
    </div>

    <script>
        // Quiz Data - –¢–µ–ø–µ—Ä—å 3 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞
        const quizData = [
            {
                q: "–î–∏—Å–∫—Ä–µ—Ç—Ç—ñ –≤–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “õ–∞—Ç–∞—Ä –¥–µ–≥–µ–Ω—ñ–º—ñ–∑ –Ω–µ?",
                options: [
                    "–ë–µ–ª–≥—ñ–Ω—ñ“£ –º”ô–Ω–¥–µ—Ä—ñ “Ø–∑–¥—ñ–∫—Å—ñ–∑ –∞—Ä–∞–ª—ã“õ—Ç–∞—Ä —Ç“Ø—Ä—ñ–Ω–¥–µ –±–µ—Ä—ñ–ª–≥–µ–Ω “õ–∞—Ç–∞—Ä",
                    "–ë–µ–ª–≥—ñ–Ω—ñ“£ –º”ô–Ω–¥–µ—Ä—ñ –∂–µ–∫–µ, “Ø–∑—ñ–ª—ñ—Å—Ç—ñ —Ç“Ø—Ä–¥–µ –±–µ—Ä—ñ–ª–≥–µ–Ω “õ–∞—Ç–∞—Ä", // Correct
                    "–ë–∞—Ä–ª—ã“õ –º”ô–Ω–¥–µ—Ä—ñ –±—ñ—Ä–¥–µ–π “õ–∞—Ç–∞—Ä"
                ],
                correctIndex: 1,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–ò–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã –≤–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “õ–∞—Ç–∞—Ä “õ–∞—à–∞–Ω “õ–æ–ª–¥–∞–Ω—ã–ª–∞–¥—ã?",
                options: [
                    "–ë–µ–ª–≥—ñ–Ω—ñ“£ –º”ô–Ω–¥–µ—Ä—ñ “Ø–∑—ñ–ª—ñ—Å—Ç—ñ –±–æ–ª“ì–∞–Ω–¥–∞",
                    "–ë–µ–ª–≥—ñ–Ω—ñ“£ –º”ô–Ω–¥–µ—Ä—ñ “Ø–∑–¥—ñ–∫—Å—ñ–∑ –∂”ô–Ω–µ –∫”©–ø –±–æ–ª“ì–∞–Ω–¥–∞", // Correct
                    "–¢–µ–∫ —Å–∞–ø–∞–ª—ã“õ –±–µ–ª–≥—ñ–ª–µ—Ä “Ø—à—ñ–Ω"
                ],
                correctIndex: 1,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–î–∏—Å–∫—Ä–µ—Ç—Ç—ñ “õ–∞—Ç–∞—Ä –º—ã—Å–∞–ª—ã:",
                options: [
                    "–û“õ—É—à—ã–ª–∞—Ä–¥—ã“£ –±–æ–π—ã (—Å–º)",
                    "–°—Ç—É–¥–µ–Ω—Ç—Ç–µ—Ä–¥—ñ“£ –∂–∞—Å—ã (–∂—ã–ª–º–µ–Ω)",
                    "–ë–∞“ì–∞–ª–∞—Ä (2, 3, 4, 5)" // Correct
                ],
                correctIndex: 2,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–ò–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã “õ–∞—Ç–∞—Ä–¥–∞ –Ω–µ–Ω—ñ –∫”©—Ä—Å–µ—Ç—É –∫–µ—Ä–µ–∫?",
                options: [
                    "–¢–µ–∫ –µ“£ –∫—ñ—à—ñ –º”ô–Ω–¥—ñ",
                    "–ë–µ–ª–≥—ñ –º”ô–Ω–¥–µ—Ä—ñ –º–µ–Ω –æ–ª–∞—Ä–¥—ã“£ –æ—Ä—Ç–∞ –º”ô–Ω—ñ–Ω",
                    "–ò–Ω—Ç–µ—Ä–≤–∞–ª–¥–∞—Ä –º–µ–Ω –∂–∏—ñ–ª—ñ–∫—Ç–µ—Ä–¥—ñ" // Correct
                ],
                correctIndex: 2,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–í–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “õ–∞—Ç–∞—Ä “õ“±—Ä—É “Ø—à—ñ–Ω –º”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä “õ–∞–Ω–¥–∞–π —Ä–µ—Ç–ø–µ–Ω –æ—Ä–Ω–∞–ª–∞—Å—Ç—ã—Ä—ã–ª—É—ã –∫–µ—Ä–µ–∫?",
                options: [
                    "–ö–µ–∑–¥–µ–π—Å–æ“õ —Ä–µ—Ç–ø–µ–Ω",
                    "–ñ–∏—ñ–ª—ñ–∫—Ç–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞",
                    "”®—Å—É –Ω–µ–º–µ—Å–µ –∫–µ–º—É —Ä–µ—Ç—ñ–º–µ–Ω (—Ä–∞–Ω–∂–∏—Ä–ª–µ—É)" // Correct
                ],
                correctIndex: 2,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–í–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “õ–∞—Ç–∞—Ä–¥—ã“£ –±–∞—Å—Ç—ã –º–∞“õ—Å–∞—Ç—ã:",
                options: [
                    "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞–ª—ã“õ ”©—Ä–Ω–µ–∫ —Ç–∞–±—É",
                    "–ú”ô–ª—ñ–º–µ—Ç—Ç–µ—Ä–¥—ñ –∂“Ø–π–µ–ª–µ—É –∂”ô–Ω–µ —Ç–∞–ª–¥–∞—É", // Correct
                    "–¢”ô–∂—ñ—Ä–∏–±–µ –∂–∞—Å–∞—É"
                ],
                correctIndex: 1,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–ò–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã –≤–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “õ–∞—Ç–∞—Ä–¥—ã“£ –º—ã—Å–∞–ª—ã:",
                options: [
                    "2, 3, 3, 4, 5, 5",
                    "150‚Äì160 —Å–º, 160‚Äì170 —Å–º, 170‚Äì180 —Å–º", // Correct
                    "1, 2, 3, 4"
                ],
                correctIndex: 1,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–î–∏—Å–∫—Ä–µ—Ç—Ç—ñ –∂”ô–Ω–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã “õ–∞—Ç–∞—Ä–ª–∞—Ä–¥—ã“£ –∞–π—ã—Ä–º–∞—à—ã–ª—ã“ì—ã –Ω–µ–¥–µ?",
                options: [
                    "–î–∏—Å–∫—Ä–µ—Ç—Ç—ñ “õ–∞—Ç–∞—Ä–¥–∞ –º”ô–Ω–¥–µ—Ä “Ø–∑—ñ–ª—ñ—Å—Ç—ñ, –∞–ª –∏–Ω—Ç–µ—Ä–≤–∞–ª–¥—ã–¥–∞ ‚Äî —Ç–æ–ø—Ç–∞–ª“ì–∞–Ω", // Correct
                    "–ï–∫–µ—É—ñ –¥–µ –±—ñ—Ä–¥–µ–π",
                    "–î–∏—Å–∫—Ä–µ—Ç—Ç—ñ “õ–∞—Ç–∞—Ä “Ø–∑–¥—ñ–∫—Å—ñ–∑"
                ],
                correctIndex: 0,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–í–∞—Ä–∏–∞—Ü–∏—è–ª—ã“õ “õ–∞—Ç–∞—Ä–¥—ã“£ —ç–ª–µ–º–µ–Ω—Ç—Ç–µ—Ä—ñ “õ–∞–Ω–¥–∞–π?",
                options: [
                    "–ë–µ–ª–≥—ñ –º”ô–Ω–¥–µ—Ä—ñ –∂”ô–Ω–µ –∂–∏—ñ–ª—ñ–∫—Ç–µ—Ä", // Correct
                    "–£–∞“õ—ã—Ç –ø–µ–Ω –æ—Ä—ã–Ω",
                    "–ë–∞“ì–∞ –∂”ô–Ω–µ —Ç“Ø—Å"
                ],
                correctIndex: 0,
                optionLabels: ["A", "B", "C"]
            },
            {
                q: "–ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–∞–Ω—ã –∫”©–±–µ–π—Å–µ, –Ω–µ ”©–∑–≥–µ—Ä–µ–¥—ñ?",
                options: [
                    "–ú”ô–ª—ñ–º–µ—Ç –¥”ô–ª–¥—ñ–≥—ñ —Ç”©–º–µ–Ω–¥–µ–π–¥—ñ",
                    "–ú”ô–ª—ñ–º–µ—Ç –Ω–∞“õ—Ç—ã–ª—ã“ì—ã –∞—Ä—Ç–∞–¥—ã", // Correct
                    "–û—Ä—Ç–∞—à–∞ –º”ô–Ω ”©–∑–≥–µ—Ä–º–µ–π–¥—ñ"
                ],
                correctIndex: 1,
                optionLabels: ["A", "B", "C"]
            }
        ];

        let state = {
            p1Name: '',
            p2Name: '',
            p1Score: 0,
            p2Score: 0,
            currentQuestionIndex: 0,
            isQuestionActive: false,
            p1Answered: false,
            p2Answered: false,
            p1LastAnswer: null, // Index of last selection
            p2LastAnswer: null,
            timer: 10,
            timerInterval: null
        };

        // Key mappings for 3 options (A, S, D and J, K, L)
        const P1_KEYS = { 'a': 0, 's': 1, 'd': 2 };
        const P2_KEYS = { 'j': 0, 'k': 1, 'l': 2 };

        /**
         * Switches screen visibility.
         * @param {string} screenId - ID of the screen to show ('startScreen', 'gameScreen', 'resultsScreen').
         */
        function switchScreen(screenId) {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById(screenId).classList.remove('hidden');
        }

        /**
         * Starts the game from the input screen.
         */
        function startGame() {
            const p1Input = document.getElementById('p1Name').value.trim();
            const p2Input = document.getElementById('p2Name').value.trim();

            if (!p1Input || !p2Input) {
                showMessage("–ê“õ–∞—É–ª—ã“õ: ”®—Ç—ñ–Ω—ñ—à, –µ–∫—ñ –æ–π—ã–Ω—à—ã–Ω—ã“£ –¥–∞ –∞—Ç—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑.", 'error');
                return;
            }

            state.p1Name = p1Input;
            state.p2Name = p2Input;
            state.currentQuestionIndex = 0;
            state.p1Score = 0;
            state.p2Score = 0;

            document.getElementById('p1Display').textContent = state.p1Name;
            document.getElementById('p2Display').textContent = state.p2Name;
            document.getElementById('p1Score').textContent = state.p1Score;
            document.getElementById('p2Score').textContent = state.p2Score;

            switchScreen('gameScreen');
            renderQuestion();
        }

        /**
         * Renders the current question and starts the timer.
         */
        function renderQuestion() {
            if (state.currentQuestionIndex >= quizData.length) {
                showResults();
                return;
            }

            const q = quizData[state.currentQuestionIndex];
            state.isQuestionActive = true;
            state.p1Answered = false;
            state.p2Answered = false;
            state.p1LastAnswer = null;
            state.p2LastAnswer = null;
            state.timer = 10;
            
            document.getElementById('questionText').textContent = q.q;
            document.getElementById('currentQuestionNumber').textContent = state.currentQuestionIndex + 1;
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('p1Status').textContent = '';
            document.getElementById('p2Status').textContent = '';

            // Render options for Player 1 (only 3 options)
            document.getElementById('p1Options').innerHTML = q.options.map((option, index) => `
                <div id="p1_opt_${index}" class="option-item hover:bg-red-200" onclick="handleAnswer('p1', ${index})">
                    <span class="font-bold mr-3">${q.optionLabels[index]} (${Object.keys(P1_KEYS)[index].toUpperCase()})</span>
                    <span class="option-text">${option}</span>
                </div>
            `).join('');

            // Render options for Player 2 (only 3 options)
            document.getElementById('p2Options').innerHTML = q.options.map((option, index) => `
                <div id="p2_opt_${index}" class="option-item hover:bg-blue-200" onclick="handleAnswer('p2', ${index})">
                    <span class="font-bold mr-3">${q.optionLabels[index]} (${Object.keys(P2_KEYS)[index].toUpperCase()})</span>
                    <span class="option-text">${option}</span>
                </div>
            `).join('');

            startTimer();
        }

        /**
         * Starts the 10-second countdown timer.
         */
        function startTimer() {
            clearInterval(state.timerInterval);
            const timerBar = document.getElementById('timerBar');
            
            state.timerInterval = setInterval(() => {
                state.timer -= 0.1;
                const percentage = (state.timer / 10) * 100;
                timerBar.style.width = `${percentage}%`;

                if (state.timer <= 3) {
                    timerBar.classList.remove('bg-yellow-500');
                    timerBar.classList.add('bg-red-600');
                } else {
                    timerBar.classList.remove('bg-red-600');
                    timerBar.classList.add('bg-yellow-500');
                }

                if (state.timer <= 0) {
                    clearInterval(state.timerInterval);
                    handleTimeUp();
                }

                // If both players have answered, stop timer early
                if (state.p1Answered && state.p2Answered) {
                    clearInterval(state.timerInterval);
                    handleEndOfTurn();
                }

            }, 100);
        }

        /**
         * Handles the end of the 10-second timer.
         */
        function handleTimeUp() {
            state.isQuestionActive = false;
            document.getElementById('nextBtn').classList.remove('hidden');
            
            // Highlight correct answer for both sides
            highlightCorrectAnswer();
            
            if (!state.p1Answered) document.getElementById('p1Status').textContent = '–£–∞“õ—ã—Ç –∞—è“õ—Ç–∞–ª–¥—ã!';
            if (!state.p2Answered) document.getElementById('p2Status').textContent = '–£–∞“õ—ã—Ç –∞—è“õ—Ç–∞–ª–¥—ã!';
        }

        /**
         * Handles the end of turn when both players answer.
         */
        function handleEndOfTurn() {
            state.isQuestionActive = false;
            document.getElementById('nextBtn').classList.remove('hidden');
            highlightCorrectAnswer();
        }
        
        /**
         * Handles a player selecting an answer.
         * @param {string} player - 'p1' or 'p2'.
         * @param {number} optionIndex - Index of the selected option.
         */
        function handleAnswer(player, optionIndex) {
            if (!state.isQuestionActive) return;

            const q = quizData[state.currentQuestionIndex];
            const isCorrect = optionIndex === q.correctIndex;
            const statusElement = document.getElementById(`${player}Status`);
            const optionElement = document.getElementById(`${player}_opt_${optionIndex}`);

            if (player === 'p1' && state.p1Answered) return;
            if (player === 'p2' && state.p2Answered) return;
            
            // Mark player as answered
            if (player === 'p1') {
                state.p1Answered = true;
                state.p1LastAnswer = optionIndex;
            } else {
                state.p2Answered = true;
                state.p2LastAnswer = optionIndex;
            }

            // Apply styling immediately
            optionElement.classList.remove('hover:bg-red-200', 'hover:bg-blue-200');
            optionElement.classList.add(isCorrect ? 'p-bg-correct' : 'p-bg-incorrect');
            
            if (isCorrect) {
                statusElement.textContent = `–î“±—Ä—ã—Å!`;
                // Check if this player was the first correct one (and the other one didn't answer yet)
                const otherPlayerAnsweredCorrectly = (player === 'p1' ? state.p2Answered : state.p1Answered) && (player === 'p1' ? state.p2LastAnswer : state.p1LastAnswer) === q.correctIndex;
                
                if (!otherPlayerAnsweredCorrectly) {
                    if (player === 'p1') {
                        state.p1Score++;
                        document.getElementById('p1Score').textContent = state.p1Score;
                        showMessage(`${state.p1Name} +1 “±–ø–∞–π (–ë—ñ—Ä—ñ–Ω—à—ñ)`, 'success');
                    } else {
                        state.p2Score++;
                        document.getElementById('p2Score').textContent = state.p2Score;
                        showMessage(`${state.p2Name} +1 “±–ø–∞–π (–ë—ñ—Ä—ñ–Ω—à—ñ)`, 'success');
                    }
                    
                    // Stop game, the point is awarded to the first correct player
                    handleEndOfTurn();
                } else if (state.p1Answered && state.p2Answered) {
                     // Both answered, first one to answer correctly gets the point logic is complex, 
                     // but since we only care about the FIRST correct answer, the point is already given.
                     // The logic above ensures the point is only given to the first correct answer.
                     handleEndOfTurn();
                }

            } else {
                statusElement.textContent = `“ö–∞—Ç–µ!`;
                if (state.p1Answered && state.p2Answered) {
                    handleEndOfTurn();
                }
            }
        }
        
        /**
         * Highlight the correct answer for visual review after the turn ends.
         */
        function highlightCorrectAnswer() {
            const q = quizData[state.currentQuestionIndex];
            const correctIndex = q.correctIndex;

            // Highlight on P1 side
            const p1CorrectOpt = document.getElementById(`p1_opt_${correctIndex}`);
            p1CorrectOpt.classList.remove('hover:bg-red-200');
            if (state.p1LastAnswer !== correctIndex) {
                 p1CorrectOpt.classList.add('p-bg-correct');
                 p1CorrectOpt.style.border = '3px dashed #10b981';
            }

            // Highlight on P2 side
            const p2CorrectOpt = document.getElementById(`p2_opt_${correctIndex}`);
            p2CorrectOpt.classList.remove('hover:bg-blue-200');
            if (state.p2LastAnswer !== correctIndex) {
                 p2CorrectOpt.classList.add('p-bg-correct');
                 p2CorrectOpt.style.border = '3px dashed #10b981';
            }
        }


        /**
         * Moves to the next question.
         */
        function nextQuestion() {
            if (state.currentQuestionIndex < quizData.length - 1) {
                state.currentQuestionIndex++;
                renderQuestion();
            } else {
                showResults();
            }
        }

        /**
         * Displays final results and winner.
         */
        function showResults() {
            clearInterval(state.timerInterval);
            switchScreen('resultsScreen');

            const resultsElement = document.getElementById('finalResults');
            let resultText = `
                <p class="text-3xl font-bold mb-4">“ö–æ—Ä—ã—Ç—ã–Ω–¥—ã:</p>
                <p class="text-2xl p1-text font-bold">${state.p1Name}: ${state.p1Score} “±–ø–∞–π</p>
                <p class="text-2xl p2-text font-bold mb-4">${state.p2Name}: ${state.p2Score} “±–ø–∞–π</p>
            `;

            if (state.p1Score > state.p2Score) {
                resultText += `<p class="text-4xl text-green-600 font-extrabold mt-4">${state.p1Name} –ñ–ï“¢–Ü–ú–ü–ê–ó! üèÜ</p>`;
            } else if (state.p2Score > state.p1Score) {
                resultText += `<p class="text-4xl text-green-600 font-extrabold mt-4">${state.p2Name} –ñ–ï“¢–Ü–ú–ü–ê–ó! üèÜ</p>`;
            } else {
                resultText += `<p class="text-4xl text-yellow-600 font-extrabold mt-4">–¢–ï“¢ –û–ô–´–ù! (DRAW) ü§ù</p>`;
            }

            resultsElement.innerHTML = resultText;
        }

        /**
         * Resets the game to the start screen.
         */
        function resetGame() {
            clearInterval(state.timerInterval);
            switchScreen('startScreen');
        }

        /**
         * Handles keyboard input for quick answering.
         */
        document.addEventListener('keydown', (event) => {
            if (!state.isQuestionActive) return;

            const key = event.key.toLowerCase();
            let player = null;
            let optionIndex = -1;

            if (key in P1_KEYS) {
                player = 'p1';
                optionIndex = P1_KEYS[key];
            } else if (key in P2_KEYS) {
                player = 'p2';
                optionIndex = P2_KEYS[key];
            }

            if (player && optionIndex !== -1) {
                // Trigger the click/answer handler
                handleAnswer(player, optionIndex);
            }
        });


        /**
         * Displays a temporary message box.
         * @param {string} message - The message to display.
         * @param {string} type - 'success' or 'error'.
         */
        function showMessage(message, type) {
            const msgBox = document.getElementById('messageBox');
            const msgText = document.getElementById('messageText');
            
            msgText.textContent = message;

            // Apply colors based on type
            msgBox.classList.remove('bg-green-500', 'bg-red-500', 'opacity-0', 'hidden');
            if (type === 'success') {
                msgBox.classList.add('bg-green-500');
            } else {
                msgBox.classList.add('bg-red-500');
            }

            // Show the box
            setTimeout(() => {
                msgBox.classList.remove('opacity-0');
            }, 10);
            msgBox.classList.remove('hidden');

            // Hide the box after 3 seconds
            setTimeout(() => {
                msgBox.classList.add('opacity-0');
                // Hide completely after transition
                setTimeout(() => {
                    msgBox.classList.add('hidden');
                }, 300);
            }, 3000);
        }
        
        // Initial setup
        window.onload = () => {
             // MathJax —Å–∫—Ä–∏–ø—Ç—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É –∂”ô–Ω–µ –∂–æ—é
             const mathJaxScript = document.querySelector('script[src*="mathjax"]');
             if (mathJaxScript) {
                 mathJaxScript.remove();
             }
             switchScreen('startScreen');
        };

    </script>

</body>
</html>
